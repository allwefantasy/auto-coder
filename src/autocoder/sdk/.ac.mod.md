
# Auto-Coder SDK

Auto-Coder SDK æ˜¯ä¸€ä¸ªä¸ºç¬¬ä¸‰æ–¹å¼€å‘è€…æä¾›çš„ Python SDKï¼Œå…è®¸é€šè¿‡å‘½ä»¤è¡Œå·¥å…·å’Œ Python API ä¸¤ç§æ–¹å¼ä½¿ç”¨ Auto-Coder çš„æ ¸å¿ƒåŠŸèƒ½ã€‚

## ç›®å½•ç»“æ„

```
src/autocoder/sdk/
â”œâ”€â”€ __init__.py                 # SDKä¸»å…¥å£ï¼Œæä¾›å…¬å…±API
â”œâ”€â”€ constants.py               # å¸¸é‡å®šä¹‰ï¼ˆç‰ˆæœ¬ã€é»˜è®¤å€¼ã€é…ç½®é€‰é¡¹ç­‰ï¼‰
â”œâ”€â”€ exceptions.py              # è‡ªå®šä¹‰å¼‚å¸¸ç±»
â”œâ”€â”€ cli/                       # å‘½ä»¤è¡Œæ¥å£æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ __main__.py           # CLIæ¨¡å—å…¥å£ç‚¹
â”‚   â”œâ”€â”€ completion_wrapper.py # è‡ªåŠ¨è¡¥å…¨åŒ…è£…å™¨
â”‚   â”œâ”€â”€ formatters.py         # è¾“å‡ºæ ¼å¼åŒ–å™¨
â”‚   â”œâ”€â”€ handlers.py           # å‘½ä»¤å¤„ç†å™¨ï¼ˆæ‰“å°æ¨¡å¼ã€ä¼šè¯æ¨¡å¼ï¼‰
â”‚   â”œâ”€â”€ install_completion.py # è‡ªåŠ¨è¡¥å…¨å®‰è£…è„šæœ¬
â”‚   â”œâ”€â”€ main.py               # CLIä¸»å…¥å£ç‚¹
â”‚   â””â”€â”€ options.py            # CLIé€‰é¡¹å®šä¹‰
â”œâ”€â”€ core/                      # æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ auto_coder_core.py    # AutoCoderæ ¸å¿ƒå°è£…ç±»
â”‚   â””â”€â”€ bridge.py             # æ¡¥æ¥å±‚ï¼Œè¿æ¥ç°æœ‰åŠŸèƒ½
â”œâ”€â”€ models/                    # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ options.py            # é…ç½®é€‰é¡¹æ¨¡å‹
â”‚   â”œâ”€â”€ messages.py           # æ¶ˆæ¯æ¨¡å‹
â”‚   â””â”€â”€ responses.py          # å“åº”æ¨¡å‹
â”œâ”€â”€ session/                   # ä¼šè¯ç®¡ç†
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ session.py            # å•ä¸ªä¼šè¯ç±»
â”‚   â””â”€â”€ session_manager.py    # ä¼šè¯ç®¡ç†å™¨
â””â”€â”€ utils/                     # å·¥å…·å‡½æ•°
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ formatters.py         # æ ¼å¼åŒ–å·¥å…·
    â”œâ”€â”€ io_utils.py           # IOå·¥å…·
    â””â”€â”€ validators.py         # éªŒè¯å·¥å…·
```

## å¿«é€Ÿå¼€å§‹

### 0. æ¨¡å‹é…ç½®

ç¼–è¾‘ `~/.auto-coder/keys/models.json` æ–‡ä»¶ï¼Œå¢åŠ å¦‚ä¸‹é…ç½®ï¼ˆè¿™é‡Œæ˜¯é…ç½®v3ï¼‰ï¼š


```json
[
{
    "name": "deepseek/v3",
    "description": "DeepSeek Chat is for coding",
    "model_name": "deepseek-chat",
    "model_type": "saas/openai",
    "base_url": "https://api.deepseek.com/v1",
    "api_key_path": "api.deepseek.com",
    "is_reasoning": false,
    "input_price": 0,
    "output_price": 0,
    "average_speed": 0,
    "max_output_tokens": 8096,    
}
]
```

ç„¶åå°† API KEY æ”¾åˆ°åŒç›®å½•ä¸‹çš„ `api.deepseek.com` æ–‡ä»¶é‡Œå³å¯ã€‚

åç»­ä½ å°±å¯ä»¥ä½¿ç”¨åå­— 'deepseek/v3' æ¥å¼•ç”¨è¿™ä¸ªæ¨¡å‹äº†ã€‚

### 1. å‘½ä»¤è¡Œå·¥å…·ä½¿ç”¨

#### å®‰è£…å’ŒåŸºæœ¬ä½¿ç”¨

```bash
# å•æ¬¡è¿è¡Œæ¨¡å¼
auto-coder.run --model v3_chat "Write a function to calculate Fibonacci numbers" 

# é€šè¿‡ç®¡é“æä¾›è¾“å…¥
echo "Explain this code" | auto-coder.run

# æŒ‡å®šè¾“å‡ºæ ¼å¼
auto-coder.run  "Generate a hello world function" --output-format json

# ç»§ç»­æœ€è¿‘çš„å¯¹è¯
auto-coder.run --continue "ç»§ç»­ä¿®æ”¹xxxxx"

# Resume a specific conversation by session ID
auto-coder.run --resume 550e8400-e29b-41d4-a716-446655440000 "" 
```

#### é«˜çº§é€‰é¡¹

```bash
# è®¾ç½®æœ€å¤§å¯¹è¯è½®æ•°
auto-coder.run --max-turns 5 "Help me debug this code" 
```

### 2. Python API ä½¿ç”¨

#### åŸºæœ¬æŸ¥è¯¢

```python
import asyncio
from autocoder.sdk import query, query_sync, AutoCodeOptions

# åŒæ­¥æŸ¥è¯¢
response = query_sync("Write a function to calculate Fibonacci numbers",options = AutoCodeOptions(                
        model="v3_chat"
    ))
print(response)

# å¼‚æ­¥æŸ¥è¯¢
async def async_example():
    options = AutoCodeOptions(                
        model="v3_chat"
    )
    
    async for message in query("Explain how Python decorators work", options):
        print(f"[{message.role}] {message.content}")

asyncio.run(async_example())
```

#### è¿”å›äº‹ä»¶ç”Ÿæˆå™¨

```python
import asyncio
from autocoder.sdk import query_with_events, query_with_events_sync, AutoCodeOptions

# å¼‚æ­¥äº‹ä»¶æµå¤„ç†
async def async_event_example():
    options = AutoCodeOptions(
        model="v3_chat",
        max_turns=5,
        verbose=True
    )
    
    async for event in query_with_events("Write a REST API using FastAPI", options):
        # å¤„ç†ä¸åŒç±»å‹çš„äº‹ä»¶
        if event.event_type == "start":
            print("ğŸš€ å¼€å§‹å¤„ç†è¯·æ±‚...")
        elif event.event_type == "tool_call":
            tool_name = event.data.get("tool_name", "Unknown")
            print(f"ğŸ› ï¸ æ‰§è¡Œå·¥å…·: {tool_name}")
        elif event.event_type == "tool_result":
            success = event.data.get("success", False)
            message = event.data.get("message", "")
            print(f"âœ… å·¥å…·ç»“æœ: {'æˆåŠŸ' if success else 'å¤±è´¥'} - {message}")
        elif event.event_type == "llm_output":
            text = event.data.get("text", "")
            print(f"ğŸ¤– AIå›å¤: {text}")
        elif event.event_type == "file_created":
            files = event.data.get("files", [])
            print(f"ğŸ“„ åˆ›å»ºæ–‡ä»¶: {', '.join(files)}")
        elif event.event_type == "file_modified":
            files = event.data.get("files", [])
            print(f"ğŸ“ ä¿®æ”¹æ–‡ä»¶: {', '.join(files)}")
        elif event.event_type == "completion":
            result = event.data.get("result", "")
            print(f"ğŸ ä»»åŠ¡å®Œæˆ: {result}")
        elif event.event_type == "error":
            error = event.data.get("error", "")
            print(f"âŒ é”™è¯¯: {error}")

# åŒæ­¥äº‹ä»¶æµå¤„ç†
def sync_event_example():
    options = AutoCodeOptions(
        model="v3_chat",
        output_format="json"
    )
    
    for event in query_with_events_sync("Create a simple calculator class", options):
        # è‡ªå®šä¹‰äº‹ä»¶å¤„ç†é€»è¾‘
        if event.event_type == "token_usage":
            usage = event.data.get("usage")
            if usage:
                input_tokens = getattr(usage, 'input_tokens_count', 0)
                output_tokens = getattr(usage, 'generated_tokens_count', 0)
                print(f"ğŸ“Š Tokenä½¿ç”¨: è¾“å…¥={input_tokens}, è¾“å‡º={output_tokens}")
        
        # ä¿å­˜é‡è¦äº‹ä»¶åˆ°æ–‡ä»¶
        if event.event_type in ["file_created", "file_modified", "completion"]:
            with open("events.log", "a") as f:
                f.write(f"{event.timestamp}: {event.event_type} - {event.data}\n")

# è¿è¡Œç¤ºä¾‹
asyncio.run(async_event_example())
sync_event_example()
```

### åˆå§‹åŒ–é¡¹ç›®

```python
from autocoder.sdk import init_project_if_required

init_project_if_required(
    target_dir="/path/to/project",
    project_type=".py,.ts,.js"
)
```

### é…ç½®å‚æ•°

```python
from autocoder.sdk import configure

configure("model", "v3_chat")
```

### è·å–LLMå®ä¾‹

```python
from autocoder.sdk import get_llm

llm = get_llm("v3_chat", product_mode="lite")
```
