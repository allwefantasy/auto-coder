
# Agent æ¨¡å—

AutoCoder çš„æ™ºèƒ½ä»£ç†æ¡†æ¶ï¼Œæä¾›åŸºäº LLM çš„è‡ªä¸»ä»£ç†ç³»ç»Ÿï¼Œæ”¯æŒå·¥å…·è°ƒç”¨ã€å¤šä»£ç†åä½œå’Œæµå¼äº¤äº’ã€‚

## ç›®å½•ç»“æ„

```
src/autocoder/agent/
â”œâ”€â”€ __init__.py                           # æ¨¡å—åˆå§‹åŒ–æ–‡ä»¶
â”œâ”€â”€ base_agentic/                         # æ ¸å¿ƒä»£ç†æ¡†æ¶
â”‚   â”œâ”€â”€ __init__.py                       # æ¡†æ¶åˆå§‹åŒ–
â”‚   â”œâ”€â”€ base_agent.py                     # åŸºç¡€ä»£ç†ç±»ï¼Œæ‰€æœ‰ä»£ç†çš„çˆ¶ç±»
â”‚   â”œâ”€â”€ agent_hub.py                      # ä»£ç†ç®¡ç†ä¸­å¿ƒï¼Œæ”¯æŒå¤šä»£ç†åä½œ
â”‚   â”œâ”€â”€ tool_registry.py                 # å·¥å…·æ³¨å†Œè¡¨ï¼Œç®¡ç†æ‰€æœ‰å¯ç”¨å·¥å…·
â”‚   â”œâ”€â”€ types.py                          # ç±»å‹å®šä¹‰å’Œæ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ utils.py                          # å·¥å…·å‡½æ•°å’Œè¾…åŠ©ç±»
â”‚   â”œâ”€â”€ default_tools.py                 # é»˜è®¤å·¥å…·é›†æ³¨å†Œå’Œç®¡ç†
â”‚   â”œâ”€â”€ agentic_tool_display.py          # å·¥å…·å±•ç¤ºå’Œæ ¼å¼åŒ–
â”‚   â”œâ”€â”€ agentic_lang.py                   # å¤šè¯­è¨€æ”¯æŒ
â”‚   â”œâ”€â”€ test_base_agent.py               # åŸºç¡€ä»£ç†å•å…ƒæµ‹è¯•
â”‚   â””â”€â”€ tools/                           # å·¥å…·è§£æå™¨å®ç°
â”‚       â”œâ”€â”€ __init__.py                  # å·¥å…·æ¨¡å—åˆå§‹åŒ–
â”‚       â”œâ”€â”€ base_tool_resolver.py        # å·¥å…·è§£æå™¨åŸºç±»
â”‚       â”œâ”€â”€ execute_command_tool_resolver.py    # å‘½ä»¤æ‰§è¡Œå·¥å…·
â”‚       â”œâ”€â”€ read_file_tool_resolver.py   # æ–‡ä»¶è¯»å–å·¥å…·
â”‚       â”œâ”€â”€ write_to_file_tool_resolver.py      # æ–‡ä»¶å†™å…¥å·¥å…·
â”‚       â”œâ”€â”€ replace_in_file_tool_resolver.py    # æ–‡ä»¶æ›¿æ¢å·¥å…·
â”‚       â”œâ”€â”€ search_files_tool_resolver.py       # æ–‡ä»¶æœç´¢å·¥å…·
â”‚       â”œâ”€â”€ list_files_tool_resolver.py  # æ–‡ä»¶åˆ—è¡¨å·¥å…·
â”‚       â”œâ”€â”€ ask_followup_question_tool_resolver.py  # äº¤äº’é—®ç­”å·¥å…·
â”‚       â”œâ”€â”€ attempt_completion_tool_resolver.py     # ä»»åŠ¡å®Œæˆå·¥å…·
â”‚       â”œâ”€â”€ plan_mode_respond_tool_resolver.py      # è®¡åˆ’æ¨¡å¼å“åº”å·¥å…·
â”‚       â”œâ”€â”€ use_mcp_tool_resolver.py     # MCP å·¥å…·è°ƒç”¨
â”‚       â”œâ”€â”€ talk_to_tool_resolver.py     # ä»£ç†é—´ç§èŠå·¥å…·
â”‚       â”œâ”€â”€ talk_to_group_tool_resolver.py       # ä»£ç†ç¾¤ç»„é€šä¿¡å·¥å…·
â”‚       â””â”€â”€ example_tool_resolver.py     # ç¤ºä¾‹å·¥å…·è§£æå™¨
â”œâ”€â”€ coder.py                             # ä»£ç ç”Ÿæˆä»£ç†å®ç°
â”œâ”€â”€ designer.py                          # è®¾è®¡ä»£ç†å®ç°
â”œâ”€â”€ planner.py                           # è§„åˆ’ä»£ç†å®ç°
â”œâ”€â”€ project_reader.py                    # é¡¹ç›®è¯»å–ä»£ç†
â”œâ”€â”€ auto_tool.py                         # è‡ªåŠ¨å·¥å…·ç”Ÿæˆ
â”œâ”€â”€ auto_learn.py                        # è‡ªåŠ¨å­¦ä¹ åŠŸèƒ½
â”œâ”€â”€ auto_learn_from_commit.py           # ä»æäº¤è®°å½•å­¦ä¹ 
â”œâ”€â”€ auto_review_commit.py               # è‡ªåŠ¨ä»£ç å®¡æŸ¥
â”œâ”€â”€ auto_demand_organizer.py            # éœ€æ±‚æ•´ç†ä»£ç†
â”œâ”€â”€ auto_filegroup.py                   # æ–‡ä»¶åˆ†ç»„ä»£ç†
â”œâ”€â”€ auto_guess_query.py                 # æŸ¥è¯¢æ¨æµ‹ä»£ç†
â”œâ”€â”€ agentic_filter.py                   # ä»£ç†è¿‡æ»¤å™¨
â”œâ”€â”€ entry_command_agent/                # å‘½ä»¤è¡Œå…¥å£ä»£ç†
â”‚   â”œâ”€â”€ __init__.py                     # å…¥å£æ¨¡å—åˆå§‹åŒ–
â”‚   â”œâ”€â”€ README.md                       # å…¥å£ä»£ç†è¯´æ˜æ–‡æ¡£
â”‚   â”œâ”€â”€ auto_tool.py                    # è‡ªåŠ¨å·¥å…·åŠŸèƒ½
â”‚   â”œâ”€â”€ chat.py                         # èŠå¤©äº¤äº’åŠŸèƒ½
â”‚   â”œâ”€â”€ designer.py                     # è®¾è®¡åŠŸèƒ½
â”‚   â”œâ”€â”€ generate_command.py             # å‘½ä»¤ç”Ÿæˆ
â”‚   â”œâ”€â”€ project_reader.py               # é¡¹ç›®è¯»å–
â”‚   â””â”€â”€ voice2text.py                   # è¯­éŸ³è½¬æ–‡å­—
â””â”€â”€ .ac.mod.md                          # æœ¬æ–‡æ¡£
```

## å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ä½¿ç”¨æ–¹å¼

```python
# å¯¼å…¥å¿…è¦çš„æ¨¡å—
from autocoder.agent.base_agentic import BaseAgent
from autocoder.agent.base_agentic.types import AgentRequest
from autocoder.common import AutoCoderArgs, SourceCodeList
import byzerllm

# 1. åˆå§‹åŒ–é…ç½®
args = AutoCoderArgs(
    source_dir="/path/to/project",
    model="gpt-4",
    # å…¶ä»–é…ç½®å‚æ•°...
)

# 2. åˆ›å»º LLM å®ä¾‹
llm = byzerllm.ByzerLLM()

# 3. åˆ›å»ºä»£ç†å®ä¾‹
class MyAgent(BaseAgent):
    def __init__(self, name, llm, files, args):
        super().__init__(name, llm, files, args)
        # è‡ªå®šä¹‰åˆå§‹åŒ–é€»è¾‘

# 4. å®ä¾‹åŒ–ä»£ç†
files = SourceCodeList()  # æºç æ–‡ä»¶åˆ—è¡¨
agent = MyAgent(
    name="my_agent",
    llm=llm,
    files=files,
    args=args
)

# 5. æ‰§è¡Œä»»åŠ¡
request = AgentRequest(user_input="è¯·å¸®æˆ‘åˆ†æè¿™ä¸ªé¡¹ç›®çš„ç»“æ„")
for event in agent.agentic_run(request):
    print(f"äº‹ä»¶ç±»å‹: {type(event).__name__}")
    # å¤„ç†ä¸åŒç±»å‹çš„äº‹ä»¶
```

### å·¥å…·ç³»ç»Ÿä½¿ç”¨

```python
from autocoder.agent.base_agentic.tool_registry import ToolRegistry
from autocoder.agent.base_agentic.types import BaseTool, ToolDescription, ToolExample
from autocoder.agent.base_agentic.tools.base_tool_resolver import BaseToolResolver

# 1. å®šä¹‰è‡ªå®šä¹‰å·¥å…·
class CustomTool(BaseTool):
    parameter1: str
    parameter2: int

# 2. å®šä¹‰å·¥å…·è§£æå™¨
class CustomToolResolver(BaseToolResolver):
    def resolve(self):
        # å®ç°å·¥å…·é€»è¾‘
        return ToolResult(success=True, message="å·¥å…·æ‰§è¡ŒæˆåŠŸ")

# 3. æ³¨å†Œå·¥å…·
ToolRegistry.register_tool(
    tool_tag="custom_tool",
    tool_cls=CustomTool,
    resolver_cls=CustomToolResolver,
    description=ToolDescription(description="è‡ªå®šä¹‰å·¥å…·æè¿°"),
    example=ToolExample(title="ç¤ºä¾‹", body="<custom_tool>...</custom_tool>")
)
```

### å¤šä»£ç†åä½œ

```python
from autocoder.agent.base_agentic.agent_hub import AgentHub, Group

# 1. åˆ›å»ºå¤šä¸ªä»£ç†
agent1 = MyAgent("agent1", llm, files, args)
agent2 = MyAgent("agent2", llm, files, args)

# 2. åˆ›å»ºç¾¤ç»„
group = Group("research_team")

# 3. åŠ å…¥ç¾¤ç»„
agent1.join_group(group)
agent2.join_group(group)

# 4. ç¾¤ç»„é€šä¿¡
agent1.talk_to_group(group, "å¤§å®¶å¥½ï¼Œæˆ‘ä»¬å¼€å§‹åä½œå§ï¼")

# 5. ç§èŠ
agent1.talk_to(agent2, "æˆ‘ä»¬å•ç‹¬è®¨è®ºä¸€ä¸‹è¿™ä¸ªé—®é¢˜")
```

## æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 1. BaseAgent åŸºç¡€ä»£ç†ç±»

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- **LLM äº¤äº’ç®¡ç†**ï¼šå¤„ç†ä¸å¤§è¯­è¨€æ¨¡å‹çš„å¯¹è¯å’Œæµå¼å“åº”
- **å·¥å…·è°ƒç”¨ç³»ç»Ÿ**ï¼šè§£æå’Œæ‰§è¡Œå„ç§å·¥å…·å‘½ä»¤
- **äº‹ä»¶æµå¤„ç†**ï¼šç®¡ç†ä»£ç†æ‰§è¡Œè¿‡ç¨‹ä¸­çš„å„ç§äº‹ä»¶
- **æ–‡ä»¶å˜æ›´è·Ÿè¸ª**ï¼šè®°å½•å’Œç®¡ç†æ–‡ä»¶ä¿®æ”¹å†å²
- **å¤šä»£ç†é€šä¿¡**ï¼šæ”¯æŒä»£ç†é—´çš„ç§èŠå’Œç¾¤ç»„é€šä¿¡

**ä¸»è¦æ–¹æ³•ï¼š**
- `agentic_run(request)`: æ‰§è¡Œä»£ç†ä»»åŠ¡çš„æ ¸å¿ƒæ–¹æ³•
- `run_in_terminal()`: åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»£ç†ï¼Œæä¾›ä¸°å¯Œçš„äº¤äº’ç•Œé¢
- `run_with_events()`: ä»¥äº‹ä»¶æµæ–¹å¼è¿è¡Œä»£ç†
- `join_group(group)`: åŠ å…¥ä»£ç†ç¾¤ç»„
- `talk_to(agent, content)`: ä¸å…¶ä»–ä»£ç†ç§èŠ
- `talk_to_group(group, content)`: å‘ç¾¤ç»„å‘é€æ¶ˆæ¯

### 2. ToolRegistry å·¥å…·æ³¨å†Œç³»ç»Ÿ

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- **å·¥å…·æ³¨å†Œç®¡ç†**ï¼šæ³¨å†Œã€å¸è½½å’ŒæŸ¥è¯¢å·¥å…·
- **è§£æå™¨æ˜ å°„**ï¼šç®¡ç†å·¥å…·ç±»ä¸è§£æå™¨çš„å¯¹åº”å…³ç³»
- **å·¥å…·æè¿°å’Œç¤ºä¾‹**ï¼šå­˜å‚¨å·¥å…·çš„ä½¿ç”¨è¯´æ˜å’Œç¤ºä¾‹ä»£ç 
- **é»˜è®¤å·¥å…·é›†**ï¼šç®¡ç†ç³»ç»Ÿé¢„ç½®çš„æ ‡å‡†å·¥å…·

**ä¸»è¦æ–¹æ³•ï¼š**
- `register_tool()`: æ³¨å†Œæ–°å·¥å…·
- `get_resolver_for_tool()`: è·å–å·¥å…·å¯¹åº”çš„è§£æå™¨
- `get_all_tool_descriptions()`: è·å–æ‰€æœ‰å·¥å…·æè¿°
- `reset_to_default_tools()`: é‡ç½®ä¸ºé»˜è®¤å·¥å…·é›†

### 3. AgentHub ä»£ç†ç®¡ç†ä¸­å¿ƒ

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- **ä»£ç†æ³¨å†Œ**ï¼šç®¡ç†æ‰€æœ‰æ´»è·ƒçš„ä»£ç†å®ä¾‹
- **ç¾¤ç»„ç®¡ç†**ï¼šåˆ›å»ºå’Œç®¡ç†ä»£ç†ç¾¤ç»„
- **æ¶ˆæ¯è·¯ç”±**ï¼šå¤„ç†ä»£ç†é—´çš„æ¶ˆæ¯ä¼ é€’
- **å¹¶å‘é€šä¿¡**ï¼šæ”¯æŒå¤šçº¿ç¨‹å®‰å…¨çš„ä»£ç†é€šä¿¡

**ä¸»è¦æ–¹æ³•ï¼š**
- `register_agent(agent)`: æ³¨å†Œæ–°ä»£ç†
- `get_agent(name)`: æ ¹æ®åç§°è·å–ä»£ç†
- `list_agents()`: åˆ—å‡ºæ‰€æœ‰ä»£ç†
- `get_all_groups()`: è·å–æ‰€æœ‰ç¾¤ç»„

### 4. äº‹ä»¶ç³»ç»Ÿæ¶æ„

ä»£ç†ç³»ç»Ÿä½¿ç”¨äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œæ”¯æŒä»¥ä¸‹äº‹ä»¶ç±»å‹ï¼š

- **LLMOutputEvent**: LLM æ–‡æœ¬è¾“å‡ºäº‹ä»¶
- **LLMThinkingEvent**: LLM æ€è€ƒè¿‡ç¨‹äº‹ä»¶  
- **ToolCallEvent**: å·¥å…·è°ƒç”¨äº‹ä»¶
- **ToolResultEvent**: å·¥å…·æ‰§è¡Œç»“æœäº‹ä»¶
- **CompletionEvent**: ä»»åŠ¡å®Œæˆäº‹ä»¶
- **ErrorEvent**: é”™è¯¯äº‹ä»¶
- **TokenUsageEvent**: Token ä½¿ç”¨ç»Ÿè®¡äº‹ä»¶

## Mermaid æ–‡ä»¶ä¾èµ–å›¾

```mermaid
graph TB
    %% æ ¸å¿ƒæ¨¡å—å®šä¹‰
    BaseAgent[BaseAgent<br/>åŸºç¡€ä»£ç†ç±»<br/>LLMäº¤äº’ã€å·¥å…·è°ƒç”¨ã€äº‹ä»¶å¤„ç†]
    ToolRegistry[ToolRegistry<br/>å·¥å…·æ³¨å†Œè¡¨<br/>å·¥å…·ç®¡ç†ã€è§£æå™¨æ˜ å°„]
    AgentHub[AgentHub<br/>ä»£ç†ç®¡ç†ä¸­å¿ƒ<br/>å¤šä»£ç†åä½œã€æ¶ˆæ¯è·¯ç”±]
    Types[Types<br/>ç±»å‹å®šä¹‰<br/>æ•°æ®æ¨¡å‹ã€äº‹ä»¶ç±»å‹]
    
    %% å·¥å…·ç³»ç»Ÿ
    BaseToolResolver[BaseToolResolver<br/>å·¥å…·è§£æå™¨åŸºç±»]
    DefaultTools[DefaultTools<br/>é»˜è®¤å·¥å…·é›†<br/>æ–‡ä»¶æ“ä½œã€å‘½ä»¤æ‰§è¡Œç­‰]
    
    %% å…·ä½“ä»£ç†å®ç°
    Coder[Coder<br/>ä»£ç ç”Ÿæˆä»£ç†]
    Designer[Designer<br/>è®¾è®¡ä»£ç†]
    Planner[Planner<br/>è§„åˆ’ä»£ç†]
    
    %% è¾…åŠ©æ¨¡å—
    Utils[Utils<br/>å·¥å…·å‡½æ•°]
    Display[AgenticToolDisplay<br/>å·¥å…·å±•ç¤º]
    Lang[AgenticLang<br/>å¤šè¯­è¨€æ”¯æŒ]
    
    %% å¤–éƒ¨ä¾èµ–
    ByzerLLM[ByzerLLM<br/>å¤§è¯­è¨€æ¨¡å‹å®¢æˆ·ç«¯]
    AutoCoderArgs[AutoCoderArgs<br/>é…ç½®å‚æ•°]
    SourceCodeList[SourceCodeList<br/>æºç æ–‡ä»¶åˆ—è¡¨]
    
    %% ä¾èµ–å…³ç³»
    BaseAgent --> ToolRegistry
    BaseAgent --> AgentHub
    BaseAgent --> Types
    BaseAgent --> ByzerLLM
    BaseAgent --> AutoCoderArgs
    BaseAgent --> SourceCodeList
    BaseAgent --> Utils
    BaseAgent --> Display
    BaseAgent --> Lang
    
    ToolRegistry --> Types
    ToolRegistry --> BaseToolResolver
    ToolRegistry --> DefaultTools
    
    AgentHub --> Types
    AgentHub --> Utils
    
    DefaultTools --> BaseToolResolver
    DefaultTools --> Types
    
    Coder --> BaseAgent
    Designer --> BaseAgent
    Planner --> BaseAgent
    
    %% æ ·å¼å®šä¹‰
    classDef coreClass fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
    classDef toolClass fill:#f3e5f5,stroke:#7b1fa2,stroke-width:1px
    classDef agentClass fill:#e8f5e8,stroke:#388e3c,stroke-width:1px
    classDef utilClass fill:#fff3e0,stroke:#f57c00,stroke-width:1px
    classDef externalClass fill:#fce4ec,stroke:#c2185b,stroke-width:1px
    
    class BaseAgent,ToolRegistry,AgentHub coreClass
    class BaseToolResolver,DefaultTools toolClass
    class Coder,Designer,Planner agentClass
    class Utils,Display,Lang,Types utilClass
    class ByzerLLM,AutoCoderArgs,SourceCodeList externalClass
```

### ä¾èµ–å…³ç³»è¯´æ˜

**æ ¸å¿ƒä¾èµ–æµï¼š**
1. **BaseAgent** ä½œä¸ºæ ¸å¿ƒåŸºç±»ï¼Œä¾èµ– ToolRegistry è¿›è¡Œå·¥å…·ç®¡ç†ï¼Œä¾èµ– AgentHub è¿›è¡Œå¤šä»£ç†åä½œ
2. **ToolRegistry** ç®¡ç†æ‰€æœ‰å·¥å…·çš„æ³¨å†Œå’Œè§£æå™¨æ˜ å°„ï¼Œæ˜¯å·¥å…·ç³»ç»Ÿçš„æ ¸å¿ƒ
3. **AgentHub** æä¾›ä»£ç†æ³¨å†Œå’Œç¾¤ç»„é€šä¿¡åŠŸèƒ½ï¼Œæ”¯æŒå¤šä»£ç†åä½œåœºæ™¯

**å·¥å…·ç³»ç»Ÿä¾èµ–ï¼š**
- æ‰€æœ‰å…·ä½“å·¥å…·è§£æå™¨ç»§æ‰¿è‡ª **BaseToolResolver**
- **DefaultTools** æ³¨å†Œç³»ç»Ÿé¢„ç½®çš„æ ‡å‡†å·¥å…·é›†
- å·¥å…·ç³»ç»Ÿé€šè¿‡ **Types** æ¨¡å—å®šä¹‰çš„æ•°æ®æ¨¡å‹è¿›è¡Œç±»å‹çº¦æŸ

**å¤–éƒ¨ç³»ç»Ÿé›†æˆï¼š**
- **ByzerLLM** æä¾›å¤§è¯­è¨€æ¨¡å‹è°ƒç”¨èƒ½åŠ›
- **AutoCoderArgs** æä¾›é…ç½®å‚æ•°ç®¡ç†
- **SourceCodeList** æä¾›æºç æ–‡ä»¶ç®¡ç†

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šåˆ›å»ºè‡ªå®šä¹‰ä»£ç†

```python
from autocoder.agent.base_agentic import BaseAgent
from autocoder.agent.base_agentic.types import AgentRequest

class CodeReviewAgent(BaseAgent):
    def __init__(self, name, llm, files, args):
        super().__init__(name, llm, files, args)
        # è®¾ç½®ä»£ç†è§’è‰²
        self.who_am_i("æˆ‘æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ä»£ç å®¡æŸ¥ä¸“å®¶ï¼Œæ“…é•¿å‘ç°ä»£ç ä¸­çš„é—®é¢˜å¹¶æä¾›æ”¹è¿›å»ºè®®")
    
    def review_code(self, file_path):
        """å®¡æŸ¥æŒ‡å®šæ–‡ä»¶çš„ä»£ç """
        request = AgentRequest(
            user_input=f"è¯·å®¡æŸ¥æ–‡ä»¶ {file_path} çš„ä»£ç è´¨é‡ï¼ŒåŒ…æ‹¬ä»£ç è§„èŒƒã€æ€§èƒ½ä¼˜åŒ–å’Œæ½œåœ¨é—®é¢˜"
        )
        
        # æ‰§è¡Œå®¡æŸ¥ä»»åŠ¡
        for event in self.agentic_run(request):
            if isinstance(event, CompletionEvent):
                return event.completion.result
        
        return "å®¡æŸ¥å¤±è´¥"

# ä½¿ç”¨ç¤ºä¾‹
agent = CodeReviewAgent("reviewer", llm, files, args)
result = agent.review_code("src/main.py")
print(result)
```

### ç¤ºä¾‹ 2ï¼šå¤šä»£ç†åä½œå¼€å‘

```python
from autocoder.agent.base_agentic.agent_hub import Group

# åˆ›å»ºå¼€å‘å›¢é˜Ÿ
dev_team = Group("development_team")

# åˆ›å»ºä¸åŒè§’è‰²çš„ä»£ç†
architect = BaseAgent("architect", llm, files, args).who_am_i("ç³»ç»Ÿæ¶æ„å¸ˆ")
developer = BaseAgent("developer", llm, files, args).who_am_i("åç«¯å¼€å‘å·¥ç¨‹å¸ˆ")
tester = BaseAgent("tester", llm, files, args).who_am_i("æµ‹è¯•å·¥ç¨‹å¸ˆ")

# åŠ å…¥å›¢é˜Ÿ
architect.join_group(dev_team)
developer.join_group(dev_team)
tester.join_group(dev_team)

# å¼€å§‹åä½œ
architect.talk_to_group(dev_team, "æˆ‘ä»¬éœ€è¦è®¾è®¡ä¸€ä¸ªç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼Œè¯·å¤§å®¶æä¾›æ„è§")

# ç§ä¸‹è®¨è®ºæŠ€æœ¯ç»†èŠ‚
architect.talk_to(developer, "å…³äºæ•°æ®åº“è®¾è®¡ï¼Œæˆ‘ä»¬ä½¿ç”¨ PostgreSQL è¿˜æ˜¯ MongoDBï¼Ÿ")
```

### ç¤ºä¾‹ 3ï¼šè‡ªå®šä¹‰å·¥å…·å¼€å‘

```python
from autocoder.agent.base_agentic.tool_registry import ToolRegistry
from autocoder.agent.base_agentic.types import BaseTool, ToolResult, ToolDescription, ToolExample
from autocoder.agent.base_agentic.tools.base_tool_resolver import BaseToolResolver

# 1. å®šä¹‰ä»£ç æ ¼å¼åŒ–å·¥å…·
class CodeFormatTool(BaseTool):
    file_path: str
    language: str = "python"

# 2. å®ç°å·¥å…·è§£æå™¨
class CodeFormatToolResolver(BaseToolResolver):
    def resolve(self) -> ToolResult:
        tool = self.tool
        try:
            # è¯»å–æ–‡ä»¶å†…å®¹
            with open(tool.file_path, 'r') as f:
                content = f.read()
            
            # æ ¼å¼åŒ–ä»£ç ï¼ˆè¿™é‡Œç®€åŒ–å®ç°ï¼‰
            if tool.language == "python":
                import autopep8
                formatted_content = autopep8.fix_code(content)
            else:
                formatted_content = content
            
            # å†™å›æ–‡ä»¶
            with open(tool.file_path, 'w') as f:
                f.write(formatted_content)
            
            return ToolResult(
                success=True,
                message=f"æˆåŠŸæ ¼å¼åŒ–æ–‡ä»¶ {tool.file_path}",
                content=formatted_content
            )
        except Exception as e:
            return ToolResult(
                success=False,
                message=f"æ ¼å¼åŒ–å¤±è´¥: {str(e)}"
            )

# 3. æ³¨å†Œå·¥å…·
ToolRegistry.register_tool(
    tool_tag="code_format",
    tool_cls=CodeFormatTool,
    resolver_cls=CodeFormatToolResolver,
    description=ToolDescription(
        description="æ ¼å¼åŒ–æŒ‡å®šæ–‡ä»¶çš„ä»£ç ï¼Œæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€"
    ),
    example=ToolExample(
        title="ä»£ç æ ¼å¼åŒ–ç¤ºä¾‹",
        body="""<code_format>
<file_path>src/main.py</file_path>
<language>python</language>
</code_format>"""
    )
)
```

### ç¤ºä¾‹ 4ï¼šæµå¼äº¤äº’å¤„ç†

```python
from autocoder.agent.base_agentic.types import *

def handle_agent_events(agent, request):
    """å¤„ç†ä»£ç†äº‹ä»¶æµ"""
    for event in agent.agentic_run(request):
        if isinstance(event, LLMThinkingEvent):
            print(f"ğŸ¤” æ€è€ƒä¸­: {event.text}")
        
        elif isinstance(event, LLMOutputEvent):
            print(f"ğŸ’¬ è¾“å‡º: {event.text}")
        
        elif isinstance(event, ToolCallEvent):
            tool_name = type(event.tool).__name__
            print(f"ğŸ”§ è°ƒç”¨å·¥å…·: {tool_name}")
        
        elif isinstance(event, ToolResultEvent):
            status = "âœ…" if event.result.success else "âŒ"
            print(f"{status} å·¥å…·ç»“æœ: {event.result.message}")
        
        elif isinstance(event, CompletionEvent):
            print(f"ğŸ‰ ä»»åŠ¡å®Œæˆ: {event.completion.result}")
            break
        
        elif isinstance(event, ErrorEvent):
            print(f"âŒ é”™è¯¯: {event.message}")
            break

# ä½¿ç”¨ç¤ºä¾‹
request = AgentRequest(user_input="è¯·å¸®æˆ‘åˆ›å»ºä¸€ä¸ªç®€å•çš„ Flask åº”ç”¨")
handle_agent_events(agent, request)
```

## æœ€ä½³å®è·µ

### 1. ä»£ç†åˆå§‹åŒ–é¡ºåº

éµå¾ªæ­£ç¡®çš„åˆå§‹åŒ–é¡ºåºä»¥é¿å…ç»„ä»¶å†²çªï¼š

```python
# 1. é¦–å…ˆåˆå§‹åŒ– FileMonitor
from autocoder.common.file_monitor.monitor import FileMonitor
monitor = FileMonitor(source_dir)
if not monitor.is_running():
    monitor.start()

# 2. åŠ è½½è§„åˆ™æ–‡ä»¶
from autocoder.common.rulefiles.autocoderrules_utils import get_rules
rules = get_rules(source_dir)

# 3. åŠ è½½ tokenizer
from autocoder.auto_coder_runner import load_tokenizer
load_tokenizer()

# 4. æœ€ååˆ›å»ºä»£ç†å®ä¾‹
agent = BaseAgent(name, llm, files, args)
```

### 2. å·¥å…·å¼€å‘è§„èŒƒ

- ç»§æ‰¿ `BaseTool` å®šä¹‰å·¥å…·å‚æ•°
- ç»§æ‰¿ `BaseToolResolver` å®ç°å·¥å…·é€»è¾‘
- æä¾›æ¸…æ™°çš„å·¥å…·æè¿°å’Œä½¿ç”¨ç¤ºä¾‹
- å¤„ç†å¼‚å¸¸æƒ…å†µå¹¶è¿”å›åˆé€‚çš„ `ToolResult`

### 3. å¤šä»£ç†åä½œæ¨¡å¼

- ä¸ºä»£ç†è®¾ç½®æ˜ç¡®çš„è§’è‰²å®šä¹‰
- ä½¿ç”¨ç¾¤ç»„è¿›è¡Œå›¢é˜Ÿåä½œ
- åˆç†ä½¿ç”¨ç§èŠå’Œå¹¿æ’­æ¶ˆæ¯
- é¿å…æ— æ„ä¹‰çš„å¾ªç¯å¯¹è¯

### 4. äº‹ä»¶å¤„ç†æœ€ä½³å®è·µ

- æ ¹æ®äº‹ä»¶ç±»å‹è¿›è¡Œå·®å¼‚åŒ–å¤„ç†
- åŠæ—¶å¤„ç†é”™è¯¯äº‹ä»¶
- åˆç†å±•ç¤ºæ€è€ƒè¿‡ç¨‹å’Œå·¥å…·è°ƒç”¨
- ä¿å­˜é‡è¦çš„æ‰§è¡Œç»“æœ

### 5. æ€§èƒ½ä¼˜åŒ–å»ºè®®

- åˆç†é…ç½® Token ä½¿ç”¨é™åˆ¶
- ä½¿ç”¨æµå¼å¤„ç†æå‡ç”¨æˆ·ä½“éªŒ
- é¿å…é¢‘ç¹çš„æ–‡ä»¶ I/O æ“ä½œ
- åˆç†ä½¿ç”¨ç¼“å­˜æœºåˆ¶

