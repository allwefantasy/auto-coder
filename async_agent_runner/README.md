# Auto-Coder å¼‚æ­¥ä»£ç†è¿è¡Œå™¨

è¿™æ˜¯ä¸€ä¸ª Go å®ç°çš„å¯åŠ¨å™¨ï¼Œç”¨äºç®€åŒ– git worktree å’Œ auto-coder çš„æ“ä½œæµç¨‹ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

- ğŸ¯ **æ™ºèƒ½ Markdown è§£æ** - ä½¿ç”¨æˆç†Ÿçš„ markdown è§£æå™¨æŒ‰æ ‡é¢˜ç»“æ„è‡ªåŠ¨åˆ†å‰²ä»»åŠ¡
- ğŸ“ **å¤šç§åˆ†å‰²æ¨¡å¼** - æ”¯æŒæŒ‰ H1/H2/H3 æ ‡é¢˜åˆ†å‰²ï¼Œä»¥åŠè‡ªå®šä¹‰åˆ†éš”ç¬¦
- ğŸ”§ **è‡ªåŠ¨ Git Worktree ç®¡ç†** - ä¸ºæ¯ä¸ªä»»åŠ¡åˆ›å»ºç‹¬ç«‹çš„å·¥ä½œç¯å¢ƒ
- ğŸ“ **è¯­ä¹‰åŒ–æ–‡ä»¶å‘½å** - åŸºäºæ ‡é¢˜å†…å®¹ç”Ÿæˆå‹å¥½çš„ä¸´æ—¶æ–‡ä»¶å
- â° **æ—¶é—´æˆ³æ ‡è¯†** - è‡ªåŠ¨ç”Ÿæˆæ—¶é—´æˆ³é¿å…å†²çª
- ğŸ§¹ **å®Œæ•´çš„æ¸…ç†åŠŸèƒ½** - æ”¯æŒ worktree åˆ—è¡¨æŸ¥çœ‹å’Œæ‰¹é‡æ¸…ç†
- ğŸ”— **æ— ç¼é›†æˆ** - ä¸ auto-coder.run å®Œç¾é…åˆ

## ğŸ› ï¸ å®‰è£…

### ä»æºç æ„å»º

```bash
cd async_agent_runner
make build
make install-user  # å®‰è£…åˆ° ~/bin
# æˆ–è€…
make install       # å®‰è£…åˆ° /usr/local/bin (éœ€è¦ sudo)
```

### ç¡®ä¿è·¯å¾„è®¾ç½®

å¦‚æœä½¿ç”¨ `install-user`ï¼Œè¯·ç¡®ä¿ `~/bin` åœ¨ä½ çš„ PATH ä¸­ï¼š

```bash
echo 'export PATH="$HOME/bin:$PATH"' >> ~/.zshrc
source ~/.zshrc
```

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### åˆ†å‰²æ¨¡å¼

| æ¨¡å¼ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `h1` | æŒ‰ä¸€çº§æ ‡é¢˜åˆ†å‰² (é»˜è®¤) | `# ä»»åŠ¡ä¸€` |
| `h2` | æŒ‰ä¸€ã€äºŒçº§æ ‡é¢˜åˆ†å‰² | `# ä»»åŠ¡ä¸€`<br/>`## å­ä»»åŠ¡` |
| `h3` | æŒ‰ä¸€ã€äºŒã€ä¸‰çº§æ ‡é¢˜åˆ†å‰² | `# ä»»åŠ¡ä¸€`<br/>`## å­ä»»åŠ¡`<br/>`### ç»†åˆ†ä»»åŠ¡` |
| `any` | æŒ‰æŒ‡å®šçº§åˆ«èŒƒå›´åˆ†å‰² | è‡ªå®šä¹‰ min-level å’Œ max-level |
| `delimiter` | æŒ‰è‡ªå®šä¹‰åˆ†éš”ç¬¦åˆ†å‰² (å…¼å®¹æ¨¡å¼) | `===` åˆ†éš” |

### åŸºæœ¬ç”¨æ³•

```bash
# æŒ‰ H1 æ ‡é¢˜åˆ†å‰² (é»˜è®¤æ¨¡å¼)
cat task.md | async_agent_runner --model cus/anthropic/claude-sonnet-4 --pr

# æŒ‰ H2 æ ‡é¢˜åˆ†å‰²
cat task.md | async_agent_runner --model your-model --split h2 --pr

# ä½¿ç”¨è‡ªå®šä¹‰åˆ†éš”ç¬¦ (å…¼å®¹åŸæœ‰æ–¹å¼)
cat task.md | async_agent_runner --model your-model --split delimiter --delimiter "===" --pr

# æŒ‰æŒ‡å®šæ ‡é¢˜çº§åˆ«èŒƒå›´åˆ†å‰²
cat task.md | async_agent_runner --model your-model --split any --min-level 2 --max-level 3 --pr

# æŒ‡å®šä¸åŒçš„åŸºç¡€åˆ†æ”¯
cat task.md | async_agent_runner --model your-model --from develop --pr
```

### ç®¡ç† Worktree

```bash
# åˆ—å‡ºæ‰€æœ‰ worktree
async_agent_runner list

# åªæ˜¾ç¤ºç”± async_agent_runner ç®¡ç†çš„ worktree
async_agent_runner list --only-managed

# æ¸…ç†æ‰€æœ‰ç®¡ç†çš„ worktree
async_agent_runner cleanup

# æ¸…ç†åŒ¹é…æ¨¡å¼çš„ worktree
async_agent_runner cleanup --pattern test
```

## ğŸ“ Markdown æ–‡ä»¶ç¤ºä¾‹

### æŒ‰ H1 åˆ†å‰²çš„ç¤ºä¾‹

```markdown
# ä»»åŠ¡ä¸€ï¼šåˆ›å»ºåŸºç¡€ç»„ä»¶

åˆ›å»ºåŸºæœ¬çš„ React ç»„ä»¶ç»“æ„ã€‚

è¦æ±‚ï¼š
- ä½¿ç”¨ TypeScript
- åŒ…å«åŸºæœ¬æ ·å¼

# ä»»åŠ¡äºŒï¼šæ·»åŠ ç”¨æˆ·è®¤è¯

å®ç°ç”¨æˆ·ç™»å½•å’Œæ³¨å†ŒåŠŸèƒ½ã€‚

è¦æ±‚ï¼š
- JWT è®¤è¯
- å¯†ç åŠ å¯†

# ä»»åŠ¡ä¸‰ï¼šæ•°æ®åº“é›†æˆ

é›†æˆæ•°æ®åº“åŠŸèƒ½ã€‚

è¦æ±‚ï¼š
- ä½¿ç”¨ PostgreSQL
- åŒ…å«æ•°æ®è¿ç§»
```

### æŒ‰ H2 åˆ†å‰²çš„ç¤ºä¾‹

```markdown
# ä¸»è¦åŠŸèƒ½å¼€å‘

## ç”¨æˆ·ç®¡ç†

å®ç°ç”¨æˆ·çš„ CRUD æ“ä½œã€‚

## æƒé™ç³»ç»Ÿ

å®ç°åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ã€‚

## æ•°æ®åˆ†æ

å®ç°æ•°æ®ç»Ÿè®¡å’Œå¯è§†åŒ–ã€‚

# æµ‹è¯•å’Œéƒ¨ç½²

## å•å…ƒæµ‹è¯•

ç¼–å†™å…¨é¢çš„å•å…ƒæµ‹è¯•ã€‚

## éƒ¨ç½²é…ç½®

é…ç½®ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ã€‚
```

## ğŸ”§ å·¥ä½œåŸç†

1. **è¾“å…¥è§£æ**: ä»æ ‡å‡†è¾“å…¥è¯»å– markdown å†…å®¹
2. **æ™ºèƒ½åˆ†å‰²**: ä½¿ç”¨ markdown è§£æå™¨æŒ‰æ ‡é¢˜å±‚çº§åˆ†å‰²ä»»åŠ¡
3. **Worktree åˆ›å»º**: ä¸ºæ¯ä¸ªä»»åŠ¡åˆ›å»ºç‹¬ç«‹çš„ git worktree
4. **æ–‡ä»¶ç”Ÿæˆ**: ç”Ÿæˆè¯­ä¹‰åŒ–å‘½åçš„ä¸´æ—¶ markdown æ–‡ä»¶
5. **Auto-coder æ‰§è¡Œ**: é€šè¿‡ç®¡é“æ‰§è¡Œ `cat file.md | auto-coder.run`
6. **ç»“æœè¾“å‡º**: æ˜¾ç¤ºæ‰§è¡ŒçŠ¶æ€å’Œç»“æœ

## ğŸ“ ç”Ÿæˆçš„ç›®å½•ç»“æ„

```
../async_agent_runner_workdir/
â”œâ”€â”€ stdin_åˆ›å»ºåŸºç¡€ç»„ä»¶_20231201123456/     # H1: åˆ›å»ºåŸºç¡€ç»„ä»¶
â”‚   â””â”€â”€ stdin_åˆ›å»ºåŸºç¡€ç»„ä»¶.md
â”œâ”€â”€ stdin_æ·»åŠ ç”¨æˆ·è®¤è¯_20231201123456/     # H1: æ·»åŠ ç”¨æˆ·è®¤è¯  
â”‚   â””â”€â”€ stdin_æ·»åŠ ç”¨æˆ·è®¤è¯.md
â””â”€â”€ stdin_æ•°æ®åº“é›†æˆ_20231201123456/       # H1: æ•°æ®åº“é›†æˆ
    â””â”€â”€ stdin_æ•°æ®åº“é›†æˆ.md
```

## ğŸ’¡ æ–°å¢åŠŸèƒ½ï¼šæ™ºèƒ½ Markdown æ–‡æ¡£åˆ†å‰²

### ğŸ¯ æ ¸å¿ƒç‰¹æ€§

#### 1. å¤šæ–‡æ¡£ç»“æ„è‡ªåŠ¨æ£€æµ‹
- **YAML Front Matter æ”¯æŒ**ï¼šè‡ªåŠ¨è¯†åˆ«å’Œè§£æåŒ…å« YAML å…ƒæ•°æ®çš„å¤šæ–‡æ¡£ç»“æ„
- **æ™ºèƒ½æ£€æµ‹ç®—æ³•**ï¼šåŸºäºæ–‡æ¡£ç»“æ„å’Œåˆ†éš”ç¬¦æ¨¡å¼è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦ä¸ºå¤šæ–‡æ¡£
- **å…ƒæ•°æ®æå–**ï¼šæ”¯æŒä» YAML front matter ä¸­æå–æ ‡é¢˜ã€ä¼˜å…ˆçº§ã€æ ‡ç­¾ç­‰å…ƒæ•°æ®

#### 2. å¤šç§åˆ†å‰²æ¨¡å¼
```bash
# æŒ‰ä¸€çº§æ ‡é¢˜åˆ†å‰²ï¼ˆé»˜è®¤ï¼‰
cat tasks.md | async_agent_runner --model cus/anthropic/claude-sonnet-4 --split h1 --pr

# æŒ‰äºŒçº§æ ‡é¢˜åˆ†å‰²
cat tasks.md | async_agent_runner --model xxxx --split h2 --pr

# æŒ‰ YAML front matter åˆ†å‰²å¤šæ–‡æ¡£
cat multi-doc.md | async_agent_runner --model xxxx --split frontmatter --pr

# ä½¿ç”¨è‡ªå®šä¹‰æ­£åˆ™æ¨¡å¼åˆ†å‰²
cat tasks.md | async_agent_runner --model xxxx --split custom --pattern "^## Task:" --pr

# ä½¿ç”¨åˆ†éš”ç¬¦åˆ†å‰²ï¼ˆå…¼å®¹æ¨¡å¼ï¼‰
cat tasks.md | async_agent_runner --model xxxx --split delimiter --delimiter "===" --pr
```

#### 3. æ™ºèƒ½é•¿åº¦ç®¡ç†
```bash
# è®¾ç½®æ–‡æ¡£é•¿åº¦çº¦æŸ
cat large-doc.md | async_agent_runner \
  --model xxxx \
  --min-length 100 \
  --max-length 5000 \
  --overlap 200 \
  --pr
```

**åŠŸèƒ½è¯´æ˜ï¼š**
- `--min-length`: è¿‡æ»¤è¿‡çŸ­çš„æ–‡æ¡£ç‰‡æ®µ
- `--max-length`: è‡ªåŠ¨åˆ†å‰²è¿‡é•¿çš„æ–‡æ¡£
- `--overlap`: è®¾ç½®æ–‡æ¡£é—´é‡å å†…å®¹ï¼Œä¿æŒä¸Šä¸‹æ–‡è¿ç»­æ€§

#### 4. é«˜çº§é…ç½®é€‰é¡¹

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ | ç¤ºä¾‹ |
|------|------|--------|------|
| `--split` | åˆ†å‰²æ¨¡å¼ | `h1` | `h1`, `h2`, `h3`, `any`, `delimiter`, `frontmatter`, `custom` |
| `--delimiter` | è‡ªå®šä¹‰åˆ†éš”ç¬¦ | `===` | `---`, `***`, `<!-- split -->` |
| `--min-level` | æœ€å°æ ‡é¢˜çº§åˆ« | `1` | ç”¨äº `any` æ¨¡å¼ |
| `--max-level` | æœ€å¤§æ ‡é¢˜çº§åˆ« | `6` | ç”¨äº `any` æ¨¡å¼ |
| `--pattern` | è‡ªå®šä¹‰æ­£åˆ™æ¨¡å¼ | - | `"^## Task:"`, `"^# Chapter"` |
| `--min-length` | æœ€å°æ–‡æ¡£é•¿åº¦ | `50` | å­—ç¬¦æ•° |
| `--max-length` | æœ€å¤§æ–‡æ¡£é•¿åº¦ | `10000` | å­—ç¬¦æ•° |
| `--overlap` | é‡å å¤§å° | `100` | å­—ç¬¦æ•° |

### ğŸ“„ æ”¯æŒçš„æ–‡æ¡£æ ¼å¼

#### 1. YAML Front Matter å¤šæ–‡æ¡£
```markdown
---
title: åç«¯å¼€å‘ä»»åŠ¡
priority: high
team: backend
tags: [api, database]
---

# åç«¯å¼€å‘

å¼€å‘ç”¨æˆ·ç®¡ç† API...

---
title: å‰ç«¯å¼€å‘ä»»åŠ¡
priority: medium
team: frontend
tags: [react, ui]
---

# å‰ç«¯å¼€å‘

å¼€å‘ç”¨æˆ·ç•Œé¢...
```

#### 2. æ ‡é¢˜ç»“æ„åˆ†å‰²
```markdown
# ä»»åŠ¡ä¸€ï¼šæ•°æ®åº“è®¾è®¡
è®¾è®¡ç”¨æˆ·è¡¨å’Œè®¢å•è¡¨...

# ä»»åŠ¡äºŒï¼šAPI å¼€å‘
å®ç° REST API æ¥å£...

## å­ä»»åŠ¡ 2.1ï¼šç”¨æˆ·è®¤è¯
å®ç° JWT è®¤è¯...

## å­ä»»åŠ¡ 2.2ï¼šæƒé™ç®¡ç†
å®ç°è§’è‰²æƒé™æ§åˆ¶...
```

#### 3. è‡ªå®šä¹‰æ¨¡å¼åˆ†å‰²
```markdown
ä»‹ç»å†…å®¹...

TASK: åˆ›å»ºæ•°æ®åº“
è®¾è®¡æ•°æ®åº“è¡¨ç»“æ„...

TASK: å®ç° API
å¼€å‘ REST API...

TASK: ç¼–å†™æµ‹è¯•
ç¼–å†™å•å…ƒæµ‹è¯•...
```

### ğŸ”§ ä½¿ç”¨ç¤ºä¾‹

#### åŸºç¡€ç”¨æ³•
```bash
# ç®€å•çš„ H1 æ ‡é¢˜åˆ†å‰²
echo "# Task 1\nContent 1\n\n# Task 2\nContent 2" | \
  async_agent_runner --model cus/anthropic/claude-sonnet-4 --pr
```

#### é«˜çº§ç”¨æ³•
```bash
# å¤æ‚çš„å¤šæ–‡æ¡£å¤„ç†
cat examples/multi_document_example.md | \
  async_agent_runner \
    --model cus/anthropic/claude-sonnet-4 \
    --split frontmatter \
    --min-length 200 \
    --max-length 8000 \
    --overlap 150 \
    --pr
```

#### è‡ªå®šä¹‰åˆ†å‰²å™¨
```bash
# æŒ‰è‡ªå®šä¹‰æ¨¡å¼åˆ†å‰²
cat project-tasks.md | \
  async_agent_runner \
    --model xxxx \
    --split custom \
    --pattern "^### (Task|Story|Feature):" \
    --pr
```

### ğŸ¯ åº”ç”¨åœºæ™¯

1. **é¡¹ç›®ç®¡ç†**ï¼šå°†åŒ…å«å¤šä¸ªä»»åŠ¡çš„æ–‡æ¡£è‡ªåŠ¨åˆ†å‰²ä¸ºç‹¬ç«‹çš„å·¥ä½œé¡¹
2. **æŠ€æœ¯æ–‡æ¡£**ï¼šæŒ‰ç« èŠ‚æˆ–ä¸»é¢˜åˆ†å‰²å¤§å‹æŠ€æœ¯æ–‡æ¡£
3. **éœ€æ±‚æ–‡æ¡£**ï¼šæŒ‰åŠŸèƒ½æ¨¡å—åˆ†å‰²äº§å“éœ€æ±‚æ–‡æ¡£
4. **ä»£ç å®¡æŸ¥**ï¼šå°†å¤§å‹ä»£ç å®¡æŸ¥ä»»åŠ¡åˆ†è§£ä¸ºå¤šä¸ªå°ä»»åŠ¡
5. **åŸ¹è®­ææ–™**ï¼šæŒ‰è¯¾ç¨‹å•å…ƒåˆ†å‰²åŸ¹è®­å†…å®¹

### ğŸ“Š æ€§èƒ½ç‰¹æ€§

- **æ™ºèƒ½æ£€æµ‹**ï¼šè‡ªåŠ¨è¯†åˆ«æ–‡æ¡£ç»“æ„ï¼Œæ— éœ€æ‰‹åŠ¨æŒ‡å®š
- **å†…å®¹ä¿æŒ**ï¼šæ™ºèƒ½åˆ†å‰²ç‚¹é€‰æ‹©ï¼Œä¿æŒå†…å®¹å®Œæ•´æ€§
- **ä¸Šä¸‹æ–‡ä¿ç•™**ï¼šæ”¯æŒé‡å å†…å®¹ï¼Œä¿æŒä¸Šä¸‹æ–‡è¿ç»­æ€§
- **å…ƒæ•°æ®ä¿ç•™**ï¼šä¿ç•™å¹¶ä¼ é€’æ–‡æ¡£å…ƒæ•°æ®ä¿¡æ¯
- **é”™è¯¯å¤„ç†**ï¼šåˆ†å‰²å¤±è´¥æ—¶è‡ªåŠ¨å›é€€åˆ°å…¼å®¹æ¨¡å¼

### ğŸ§ª æµ‹è¯•ç”¨ä¾‹

è¿è¡Œæµ‹è¯•éªŒè¯åŠŸèƒ½ï¼š
```bash
cd async_agent_runner
go test ./pkg/markdown -v
```

æµ‹è¯•è¦†ç›–çš„åœºæ™¯ï¼š
- âœ… å¤šæ–‡æ¡£ç»“æ„æ£€æµ‹
- âœ… YAML front matter è§£æ
- âœ… å„ç§åˆ†å‰²æ¨¡å¼
- âœ… é•¿åº¦çº¦æŸåº”ç”¨
- âœ… è‡ªå®šä¹‰åˆ†å‰²å™¨
- âœ… é‡å å†…å®¹å¤„ç†
- âœ… å…ƒæ•°æ®æå–å’Œä¿ç•™

## ğŸ’¡ é«˜çº§åŠŸèƒ½

### è‡ªå®šä¹‰å·¥ä½œç›®å½•

```bash
cat task.md | async_agent_runner --model your-model --workdir ./my_workspace --pr
```

### ç»„åˆå¤šç§é€‰é¡¹

```bash
cat complex_task.md | async_agent_runner \
  --model cus/anthropic/claude-sonnet-4 \
  --split h2 \
  --from develop \
  --workdir ../custom_workdir \
  --pr
```

## ğŸ§ª æµ‹è¯•

```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
go test ./...

# è¿è¡Œæ¼”ç¤º
./scripts/demo.sh

# éªŒè¯æ„å»º
make test
```

## ğŸ“Š ä¸åŸå§‹æ–¹å¼å¯¹æ¯”

### åŸæ¥çš„ç¹çæ“ä½œ

```bash
git worktree add ../ac004 -b ac004 master
cd ../ac004 && cat /path/to/task.md | auto-coder.run --model your-model --pr
```

### ç°åœ¨çš„ç®€åŒ–æ“ä½œ

```bash
cat /path/to/task.md | ac --model your-model --pr
```

**ç®€åŒ–ç¨‹åº¦ï¼šä» 2 è¡Œå¤æ‚å‘½ä»¤ â†’ 1 è¡Œç®€å•å‘½ä»¤**

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å‘½ä»¤æœªæ‰¾åˆ°**: ç¡®ä¿äºŒè¿›åˆ¶æ–‡ä»¶åœ¨ PATH ä¸­
2. **git worktree å¤±è´¥**: ç¡®ä¿åœ¨ git ä»“åº“ç›®å½•ä¸­è¿è¡Œ
3. **auto-coder.run æœªæ‰¾åˆ°**: ç¡®ä¿ auto-coder.run å·²æ­£ç¡®å®‰è£…

### è°ƒè¯•

```bash
# æŸ¥çœ‹ç”Ÿæˆçš„ worktree
ac list

# æŸ¥çœ‹è¯¦ç»†çš„ worktree ä¿¡æ¯
git worktree list

# æ‰‹åŠ¨æ¸…ç† worktree
ac cleanup
```

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ è®¸å¯è¯

MIT License

---

**é¡¹ç›®çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

> è¿™ä¸ªå·¥å…·å°†å¤§å¹…æå‡ä½ çš„ auto-coder å·¥ä½œæ•ˆç‡ï¼ğŸš€