# Makefile for async_agent_runner

.PHONY: build install-user clean test help

# å˜é‡
BINARY_NAME := async_agent_runner
BUILD_DIR := bin
INSTALL_DIR := $(HOME)/bin

# é»˜è®¤ç›®æ ‡
help:
	@echo "å¯ç”¨çš„ make ç›®æ ‡:"
	@echo "  build        - æ„å»ºäºŒè¿›åˆ¶æ–‡ä»¶"
	@echo "  install-user - å®‰è£…åˆ°ç”¨æˆ·ç›®å½• (~/bin)"
	@echo "  clean        - æ¸…ç†æ„å»ºæ–‡ä»¶"
	@echo "  test         - è¿è¡Œæµ‹è¯•"
	@echo "  help         - æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯"

# æ„å»ºäºŒè¿›åˆ¶æ–‡ä»¶
build:
	@echo "ğŸ”¨ æ„å»º $(BINARY_NAME)..."
	@mkdir -p $(BUILD_DIR)
	@go build -ldflags="-s -w" -o $(BUILD_DIR)/$(BINARY_NAME) .
	@echo "âœ… æ„å»ºå®Œæˆ: $(BUILD_DIR)/$(BINARY_NAME)"

# å®‰è£…åˆ°ç”¨æˆ·ç›®å½•
install-user: build
	@echo "ğŸ“¦ å®‰è£… $(BINARY_NAME) åˆ° $(INSTALL_DIR)..."
	@mkdir -p $(INSTALL_DIR)
	@cp $(BUILD_DIR)/$(BINARY_NAME) $(INSTALL_DIR)/
	@chmod +x $(INSTALL_DIR)/$(BINARY_NAME)
	@echo "âœ… å®‰è£…å®Œæˆ"
	@echo "è¯·ç¡®ä¿ $(INSTALL_DIR) åœ¨æ‚¨çš„ PATH ä¸­"

# æ¸…ç†æ„å»ºæ–‡ä»¶
clean:
	@echo "ğŸ§¹ æ¸…ç†æ„å»ºæ–‡ä»¶..."
	@rm -rf $(BUILD_DIR)
	@echo "âœ… æ¸…ç†å®Œæˆ"

# è¿è¡Œæµ‹è¯•
test:
	@echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
	@go test ./...

# æ„å»ºæ‰€æœ‰å¹³å°
build-all:
	@echo "ğŸ”¨ æ„å»ºæ‰€æœ‰å¹³å°..."
	@mkdir -p $(BUILD_DIR)
	@GOOS=linux GOARCH=amd64 go build -ldflags="-s -w" -o $(BUILD_DIR)/$(BINARY_NAME)-linux-amd64 .
	@GOOS=darwin GOARCH=amd64 go build -ldflags="-s -w" -o $(BUILD_DIR)/$(BINARY_NAME)-darwin-amd64 .
	@GOOS=darwin GOARCH=arm64 go build -ldflags="-s -w" -o $(BUILD_DIR)/$(BINARY_NAME)-darwin-arm64 .
	@GOOS=windows GOARCH=amd64 go build -ldflags="-s -w" -o $(BUILD_DIR)/$(BINARY_NAME)-windows-amd64.exe .
	@echo "âœ… å¤šå¹³å°æ„å»ºå®Œæˆ" 